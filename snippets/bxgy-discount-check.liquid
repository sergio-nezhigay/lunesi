{%- comment -%}
  BXGY Auto-Gift Discount Detection

  Detects any discount code starting with "BXGY" prefix.

  Discount Code Format: BXGY-{variantId}
  Example: BXGY-43668421771395

  The variant ID after the prefix specifies which product to add as a gift.
  If no variant ID is provided (legacy codes like BXGY01501b),
  the default gift from JS config will be used.
{%- endcomment -%}

<script>
  // BXGY Auto-Gift: Discount detection via Liquid
  window.bxgyDiscountApplied = false;
  window.bxgyAppliedCode = null;

  {%- comment -%} Check cart discount applications {%- endcomment -%}
  {%- if cart.discount_applications.size > 0 -%}
    {%- for discount in cart.discount_applications -%}
      {%- assign discount_title_upper = discount.title | upcase -%}
      {%- if discount_title_upper contains 'BXGY' -%}
        window.bxgyDiscountApplied = true;
        window.bxgyAppliedCode = {{ discount.title | json }};
        console.log('ðŸŽ BXGY: Discount detected via Liquid:', {{ discount.title | json }});
      {%- endif -%}
    {%- endfor -%}
  {%- endif -%}

  {%- comment -%} Also check checkout discount codes if on checkout {%- endcomment -%}
  {%- if checkout.discount_applications.size > 0 -%}
    {%- for discount in checkout.discount_applications -%}
      {%- assign discount_title_upper = discount.title | upcase -%}
      {%- if discount_title_upper contains 'BXGY' -%}
        window.bxgyDiscountApplied = true;
        window.bxgyAppliedCode = {{ discount.title | json }};
      {%- endif -%}
    {%- endfor -%}
  {%- endif -%}
</script>
